<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=no">
    <title>Neon OS ¬∑ –ü–û–õ–ù–ê–Ø ¬∑ –ó–∞–ø—É—Å–∫ .app —Ä–∞–±–æ—Ç–∞–µ—Ç</title>
    <link href="https://fonts.googleapis.com/css2?family=Asap:wght@300;400;500;600;700&family=Amaranth:ital,wght@0,400;0,700;1,400;1,700&family=JetBrains+Mono:wght@300;400;600&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* –ü–û–õ–ù–´–ô –ù–ï–û–ù–û–í–´–ô –°–¢–ò–õ–¨ - –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --hue1: 255; --hue2: 222; --border: 1px; --border-color: hsl(var(--hue2), 12%, 20%);
            --radius: 22px; --ease: cubic-bezier(0.5, 1, 0.89, 1);
            --glass-bg: linear-gradient(235deg, hsl(var(--hue1) 50% 10% / 0.8), hsl(var(--hue1) 50% 10% / 0) 33%), 
                        linear-gradient(45deg , hsl(var(--hue2) 50% 10% / 0.8), hsl(var(--hue2) 50% 10% / 0) 33%), 
                        linear-gradient(hsl(220deg 25% 4.8% / 0.9));
            --font-mono: 'JetBrains Mono', monospace;
            --wallpaper: url('https://assets.codepen.io/13471/abstract-light.jpg');
            --wallpaper-overlay: linear-gradient(to right in oklab, hsl(var(--hue2) 50% 75%), hsl(var(--hue1) 50% 75%));
        }
        body {
            background: #08090d;
            background-image: var(--wallpaper), var(--wallpaper-overlay);
            background-size: cover; background-position: center; background-blend-mode: hard-light;
            color: #e0e5ee; font-family: 'Asap', sans-serif; min-height: 100vh;
            transition: background-image 0.4s var(--ease);
        }
        #app { min-height: 100svh; padding: 2svw; display: flex; flex-direction: column; justify-content: space-between; }
        #app > header {
            background: rgba(0,0,0,0.2); backdrop-filter: blur(8px); padding: 1.5em 2em; border-radius: 40px;
            border: 0.5px solid rgba(255,255,255,0.1); max-width: 750px;
        }
        #app > header h1 { 
            color: color-mix(in oklab, #fff 70%, hsl(var(--hue1) 50% 50%)); 
            font-size: 2rem; text-shadow: 0 0 12px hsl(var(--hue1) 70% 60% / 0.5);
            margin-bottom: 0.2em;
        }
        #app > header p { 
            color: color-mix(in oklab, #fff 40%, hsl(var(--hue2) 50% 50%)); 
            display: flex; gap: 12px; flex-wrap: wrap; 
        }
        #app > footer {
            align-self: end; background: rgba(0,0,0,0.25); backdrop-filter: blur(8px); padding: 1em 2em; border-radius: 40px;
            border: 0.5px solid rgba(255,255,255,0.1); display: flex; flex-wrap: wrap; gap: 0.5em;
        }
        #app > footer h2 { width: 100%; font-size: 1em; font-weight: 400; color: rgba(255,255,255,0.8); }
        footer h2 button {
            font-family: Amaranth, sans-serif; font-style: italic; display: inline-flex; padding: 0.25em 0.8em;
            background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.25); border-radius: 3em;
            color: white; cursor: pointer; font-size: 0.9rem;
        }
        #app > footer [type=range] { width: 180px; accent-color: hsl(var(--hue2) 66% 60%); }
        
        .wallpaper-btn {
            background: rgba(20,30,50,0.6); border: 1px solid rgba(255,255,255,0.2); color: white;
            padding: 0.4em 1.2em; border-radius: 30px; display: inline-flex; align-items: center; gap: 6px; cursor: pointer;
            transition: 0.2s;
        }
        .wallpaper-btn:hover { background: rgba(60,80,120,0.7); border-color: rgba(255,255,255,0.5); }
        
        /* --- –ü–û–õ–ù–û–¶–ï–ù–ù–û–ï –ú–ï–ù–Æ --- */
        #menu {
            visibility: hidden; opacity: 0; pointer-events: none; transition: 0.25s var(--ease); filter: blur(4px);
            position: fixed; top: 140px; left: 2svw; min-width: 290px; max-width: 330px;
            border-radius: var(--radius); border: var(--border) solid var(--border-color); padding: 1em;
            background: var(--glass-bg); backdrop-filter: blur(16px); z-index: 10000; max-height: 80vh; overflow-y: auto;
            color: #b3bbcc;
        }
        #menu.open { visibility: visible; opacity: 1; pointer-events: auto; filter: blur(0px); }
        #menu .inner { display: flex; flex-direction: column; gap: 0.6em; font-size: 0.85rem; }
        #menu hr { margin: 0.2em 0; opacity: 0.4; border: 0.5px solid rgba(255,255,255,0.2); }
        #menu li {
            --item-hue: var(--hue2); padding: 0.6em 0.8em; display: flex; align-items: center; gap: 0.7em;
            border-radius: 14px; background: linear-gradient(90deg in oklch, hsl(var(--item-hue) 29% 13% / var(--item-opacity,0)),
                      hsl(var(--item-hue) 30% 15% / var(--item-opacity,0)) 24% 32%, transparent 95%) border-box;
            cursor: pointer; font-size: 0.85rem; border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        #menu li svg { width: 18px; height: 18px; stroke-width: 1.5; flex-shrink: 0; }
        #menu li:hover { --item-opacity: 0.6; color: white; }
        
        .wallpaper-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-top: 8px;
        }
        .wallpaper-item {
            aspect-ratio: 16/9; border-radius: 8px; border: 1.5px solid transparent; cursor: pointer;
            background-size: cover; background-position: center; transition: 0.2s;
        }
        .wallpaper-item:hover { border-color: hsl(var(--hue1) 80% 70%); transform: scale(1.02); }
        .wallpaper-item.active { border-color: white; box-shadow: 0 0 12px hsl(var(--hue1) 80% 70%); }
        
        /* --- –ù–ï–û–ù–û–í–´–ï –û–ö–ù–ê - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø --- */
        .neon-app {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 600px; max-width: 95vw; max-height: 85vh; overflow-y: auto;
            background: linear-gradient(145deg, hsl(var(--hue1) 40% 12% / 0.97), hsl(var(--hue2) 40% 8% / 0.97));
            backdrop-filter: blur(24px); border: 1px solid hsl(var(--hue1) 60% 60% / 0.5); border-radius: 28px;
            padding: 1.8em; box-shadow: 0 20px 48px -12px black, 0 0 0 1px hsl(var(--hue1) 70% 70% / 0.2) inset,
                        0 0 48px hsl(var(--hue1) 70% 60% / 0.2);
            color: white; z-index: 20000;
            opacity: 0; animation: neonAppear 0.3s var(--ease) forwards;
        }
        @keyframes neonAppear {
            0% { opacity: 0; transform: translate(-50%, -44%) scale(0.96); filter: blur(4px); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); filter: blur(0px); }
        }
        .neon-app .app-header { 
            display: flex; align-items: center; gap: 12px; margin-bottom: 1.5em; 
            border-bottom: 1px solid hsl(var(--hue2) 60% 70% / 0.3); padding-bottom: 0.8em;
        }
        .neon-app .app-header svg { width: 28px; height: 28px; stroke: hsl(var(--hue1) 80% 80%); }
        .neon-app .app-header h2 { 
            font-size: 1.7rem; font-family: 'Amaranth', sans-serif; font-style: italic;
            text-shadow: 0 0 10px hsl(var(--hue1) 80% 70% / 0.6); margin: 0;
        }
        .neon-app .app-content { 
            background: rgba(0,0,0,0.25); border-radius: 20px; padding: 1.4em;
            border: 0.5px solid rgba(255,255,255,0.1); 
        }
        .neon-app .app-close { 
            position: absolute; top: 16px; right: 20px; background: transparent; border: none;
            color: rgba(255,255,255,0.6); font-size: 28px; cursor: pointer; padding: 0 10px;
            border-radius: 30px; line-height: 1; transition: 0.2s; z-index: 10;
        }
        .neon-app .app-close:hover { background: rgba(255,255,255,0.15); color: white; }
        
        /* --- –ò–ì–†–´ --- */
        .snake-grid { 
            display: grid; grid-template-columns: repeat(15, 1fr); gap: 3px; 
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 20px; aspect-ratio: 1;
        }
        .snake-cell { aspect-ratio: 1; background: rgba(20,30,50,0.7); border-radius: 6px; transition: 0.05s; }
        .snake-cell.snake { background: hsl(var(--hue1), 80%, 65%); box-shadow: 0 0 10px hsl(var(--hue1), 80%, 60%); }
        .snake-cell.food { background: hsl(var(--hue2), 80%, 65%); box-shadow: 0 0 10px hsl(var(--hue2), 80%, 60%); border-radius: 50%; }
        
        /* --- –§–ê–ô–õ–û–í–´–ô –ú–ï–ù–ï–î–ñ–ï–† --- */
        .file-list { display: flex; flex-direction: column; gap: 10px; max-height: 350px; overflow-y: auto; margin-bottom: 20px; }
        .file-item { 
            display: flex; align-items: center; gap: 15px; padding: 0.9em 1.2em; 
            background: rgba(0,0,0,0.35); border-radius: 18px; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.15s; cursor: pointer;
        }
        .file-item:hover { background: rgba(60,80,140,0.45); border-color: rgba(255,255,255,0.2); transform: translateY(-1px); }
        .file-icon { font-size: 2rem; }
        .file-info { flex: 1; }
        .file-name { font-weight: 600; color: white; font-size: 1rem; margin-bottom: 4px; }
        .file-meta { font-size: 0.7rem; opacity: 0.7; }
        .file-actions { display: flex; gap: 10px; }
        .file-run { 
            background: hsl(var(--hue1), 70%, 60%); border: none; border-radius: 30px; 
            padding: 0.5em 1.3em; color: white; font-size: 0.8rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 0 10px hsl(var(--hue1), 70%, 50% / 0.3); transition: 0.1s;
        }
        .file-run:hover { background: hsl(var(--hue1), 80%, 70%); transform: scale(1.05); }
        .file-delete { background: rgba(200,60,60,0.7); border: none; border-radius: 30px; padding: 0.5em 1.1em; color: white; font-size: 0.8rem; cursor: pointer; }
        .download-area { 
            border: 2px dashed rgba(255,255,255,0.3); border-radius: 20px; padding: 1.5em; 
            text-align: center; cursor: pointer; transition: 0.2s; margin-top: 10px;
        }
        .download-area:hover { border-color: hsl(var(--hue1), 70%, 70%); background: rgba(100,100,200,0.15); }
        
        /* --- –ü–†–û–°–ú–û–¢–†–©–ò–ö –§–ê–ô–õ–û–í --- */
        .file-viewer { 
            background: rgba(0,0,0,0.5); border-radius: 18px; padding: 1.2em; 
            border: 1px solid rgba(255,255,255,0.1); max-height: 300px; overflow-y: auto; 
            font-family: var(--font-mono); white-space: pre-wrap; font-size: 0.9rem;
        }
        
        /* --- –ë–†–ê–£–ó–ï–† --- */
        .browser-url { 
            flex: 1; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.15); 
            border-radius: 30px; padding: 0.7em 1.2em; color: white; font-size: 0.9rem;
        }
        .browser-go { 
            background: hsl(var(--hue1), 70%, 60%); border: none; border-radius: 30px; 
            padding: 0.7em 1.8em; color: white; font-weight: 600; cursor: pointer;
        }
        
        /* --- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø --- */
        .neon-notification {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.95); backdrop-filter: blur(12px); color: white; padding: 0.9em 2.2em;
            border-radius: 50px; border: 1px solid hsl(var(--hue1) 70% 70% / 0.6); font-size: 0.95rem;
            z-index: 30000; animation: notifFade 4s ease forwards; max-width: 90vw;
            box-shadow: 0 0 25px hsl(var(--hue1) 70% 60% / 0.4);
        }
        @keyframes notifFade {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        .social-icon {
            position: fixed; bottom: 16px; right: 16px; z-index: 9999; background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px); padding: 0.5em 1.2em; border-radius: 30px; color: #ccc; text-decoration: none;
            display: flex; gap: 6px; align-items: center; font-size: 0.85rem; border: 0.5px solid rgba(255,255,255,0.2);
            transition: 0.2s;
        }
        .social-icon:hover { background: rgba(40,50,80,0.7); color: white; border-color: rgba(255,255,255,0.5); }
        .social-icon.codepen { right: auto; left: 16px; }
        .social-icon svg { width: 18px; height: 18px; fill: currentColor; }
    </style>
</head>
<body>

<main id="app">
    <header>
        <h1>‚ö° NEON OS ¬∑ –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø</h1>
        <p>
            üöÄ 8 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ¬∑ –ò–≥—Ä—ã ¬∑ –ë—Ä–∞—É–∑–µ—Ä ¬∑ –§–∞–π–ª—ã ¬∑ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ .exe ‚Üí .app ¬∑ –ó–ê–ü–£–°–ö .app
            <span class="wallpaper-btn" id="openWallpaperMenu">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor">
                    <path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"/>
                </svg>
                –û–±–æ–∏
            </span>
        </p>
    </header>
    <footer class="dark">
        <h2>üé® –¢–µ–º–∞ ¬∑ <button class='random' id="randomBtn">randomize</button></h2>
        <input type="range" id="h1" min="0" max="360" value="255">
        <input type="range" id="h2" min="0" max="360" value="222">
    </footer>
</main>

<aside id="menu">
    <div class="inner">
        <section>
            <header style="font-size:0.7rem; opacity:0.8; letter-spacing:2px;">üéÆ –ò–ì–†–´</header>
            <ul>
                <li data-app="snake">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 6v6l4 2"/><circle cx="12" cy="12" r="9"/>
                    </svg> –ó–º–µ–π–∫–∞ Neon (15x15)
                </li>
                <li data-app="snake2">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 12h16M12 4v16"/>
                    </svg> –ó–º–µ–π–∫–∞ –ö–ª–∞—Å—Å–∏–∫ (12x12)
                </li>
            </ul>
        </section>
        <hr>
        <section>
            <header style="font-size:0.7rem; opacity:0.8; letter-spacing:2px;">üåê –ò–ù–¢–ï–†–ù–ï–¢</header>
            <ul>
                <li data-app="browser">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="9"/><path d="M12 3v18M3 12h18"/>
                    </svg> NeonBrowser (WebView)
                </li>
                <li data-app="files">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M2.5 12.5L9 5l6.5 7.5M9 5v14"/>
                    </svg> –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
                </li>
            </ul>
        </section>
        <hr>
        <section>
            <header style="font-size:0.7rem; opacity:0.8; letter-spacing:2px;">üß∞ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø</header>
            <ul>
                <li data-app="weather">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"/>
                    </svg> –ü–æ–≥–æ–¥–∞ (–†–æ—Å—Å–∏—è)
                </li>
                <li data-app="calculator">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5Zm0 2.25h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V18Zm2.498-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z"/>
                    </svg> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                </li>
                <li data-app="notes">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h4.5m-5.273-9.955a3.75 3.75 0 0 1 5.304 0l6.19 6.19a3.75 3.75 0 0 1 0 5.304l-4.095 4.095a3.75 3.75 0 0 1-5.304 0l-6.19-6.19a3.75 3.75 0 0 1 0-5.304l1.095-1.095Z"/>
                    </svg> –ó–∞–º–µ—Ç–∫–∏
                </li>
                <li data-app="music">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a2.25 2.25 0 0 1-2.673-1.632l-.377-1.32a2.25 2.25 0 0 1 1.632-2.673L19.5 9.553Z"/>
                    </svg> –ú—É–∑—ã–∫–∞
                </li>
                <li data-app="terminal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 5.25h13.5A2.25 2.25 0 0 0 21 15V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v9a2.25 2.25 0 0 0 2.25 2.25Z"/>
                    </svg> –¢–µ—Ä–º–∏–Ω–∞–ª
                </li>
                <li data-app="timer">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 6v6l4 2m-4-10.5a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z"/>
                    </svg> –¢–∞–π–º–µ—Ä
                </li>
            </ul>
        </section>
        <section class="wallpaper-section">
            <header style="font-size:0.7rem; opacity:0.8; display:flex; align-items:center; gap:4px;">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor">
                    <path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"/>
                </svg>
                –û–±–æ–∏
            </header>
            <div class="wallpaper-grid" id="wallpaperGrid"></div>
        </section>
    </div>
</aside>

<a class="social-icon codepen" href="https://codepen.io/simeydotme">‚ö° NEON OS</a>
<a class="social-icon twitter" href="https://twitter.com/simeydotme"><svg viewBox="0 0 24 24"><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737s-2.643 2.06-2.62 3.737v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84 0 0 0 .497-3.753c-.002-.249 1.51-2.772 1.818-4.013z"/></svg></a>
<a class="social-icon github" href="https://github.com/simeydotme"><svg viewBox="0 0 24 24"><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0c-2.4-1.6-3.5-1.3-3.5-1.3a4.2 4.2 0 0 0-.1 3.2 4.6 4.6 0 0 0-1.3 3.2c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2v3.5"/></svg></a>

<script>
    (function(){
        "use strict";

        // ---------- –≠–õ–ï–ú–ï–ù–¢–´ ----------
        const $menu = document.getElementById('menu');
        const $menuItems = $menu.querySelectorAll('li');
        const $hue1 = document.getElementById('h1');
        const $hue2 = document.getElementById('h2');
        const $rand = document.getElementById('randomBtn');
        const $openWallpaperBtn = document.getElementById('openWallpaperMenu');
        let cleanTimer;

        // ========== API ==========
        const WEATHER_API_KEY = "181ac29b75bb4115a86191537261102";
        const RUSSIAN_CITIES = ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–°–æ—á–∏", "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫"];

        // ========== –§–ê–ô–õ–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê ==========
        let neonFileSystem = JSON.parse(localStorage.getItem('neon-files')) || [
            { name: "README.txt", type: "txt", size: "1.2 KB", date: new Date().toLocaleDateString(), content: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Neon OS!\n\n‚úÖ –≠—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.\n‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ .exe ‚Üí –ø–æ–ª—É—á–∞–π—Ç–µ .app\n‚úÖ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–≤–æ–π–Ω—ã–º –∫–ª–∏–∫–æ–º." },
            { name: "neon_installer.exe", type: "exe", size: "2.5 MB", date: new Date().toLocaleDateString(), content: "NEON_INSTALLER_v2.0" },
            { name: "snake_game.app", type: "app", size: "1.8 MB", date: new Date().toLocaleDateString(), content: "NEON_APP_INSTALLED", appName: "Neon Snake", appType: "game" },
            { name: "browser.app", type: "app", size: "2.1 MB", date: new Date().toLocaleDateString(), content: "NEON_APP_INSTALLED", appName: "NeonBrowser", appType: "browser" },
            { name: "calculator.app", type: "app", size: "1.2 MB", date: new Date().toLocaleDateString(), content: "NEON_APP_INSTALLED", appName: "Neon Calc", appType: "calculator" }
        ];

        function saveFileSystem() {
            localStorage.setItem('neon-files', JSON.stringify(neonFileSystem));
        }

        // ========== –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö –§–ê–ô–õ–û–í ==========
        function runFile(file) {
            const ext = file.type.toLowerCase();
            
            // ‚úÖ .app - –£–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ò–ï
            if (ext === 'app') {
                showNotification(`üöÄ –ó–∞–ø—É—Å–∫: ${file.appName || file.name}`, 1800);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                if (file.appName?.includes('Snake') || file.appType === 'game' || file.name.includes('snake')) {
                    createSnakeGame(15);
                } else if (file.appName?.includes('Browser') || file.appType === 'browser' || file.name.includes('browser')) {
                    createNeonBrowser();
                } else if (file.appName?.includes('Calc') || file.appType === 'calculator' || file.name.includes('calc')) {
                    createCalculator();
                } else if (file.appName?.includes('Weather') || file.name.includes('weather')) {
                    createWeatherApp();
                } else if (file.appName?.includes('Music') || file.name.includes('music')) {
                    createMusicApp();
                } else if (file.appName?.includes('Terminal') || file.name.includes('terminal')) {
                    createTerminalApp();
                } else if (file.appName?.includes('Timer') || file.name.includes('timer')) {
                    createTimerApp();
                } else if (file.appName?.includes('Notes') || file.name.includes('notes')) {
                    createNotesApp();
                } else {
                    // –û–±—â–µ–µ –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                    const appWin = document.createElement('div');
                    appWin.className = 'neon-app';
                    appWin.style.width = '450px';
                    appWin.innerHTML = `
                        <button class="app-close">‚úï</button>
                        <div class="app-header">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                <path d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <h2>${file.appName || file.name.replace('.app','')}</h2>
                        </div>
                        <div class="app-content" style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 16px;">‚úÖ</div>
                            <div style="margin-bottom: 20px; font-size: 1.2rem; font-weight: 500;">
                                ${file.appName || file.name}
                            </div>
                            <div style="background: rgba(0,0,0,0.4); border-radius: 30px; padding: 16px; margin-bottom: 20px;">
                                üì¶ –í–µ—Ä—Å–∏—è: 1.0<br>
                                üñ•Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Neon OS
                            </div>
                            <button class="app-close" style="background: hsl(var(--hue1),70%,60%); border: none; padding: 0.7em 2.2em; border-radius: 30px; color: white; font-size: 1rem; cursor: pointer; position: static;">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    `;
                    document.body.appendChild(appWin);
                    appWin.querySelectorAll('.app-close').forEach(btn => {
                        btn.addEventListener('click', () => appWin.remove());
                    });
                }
                return;
            }
            
            // ‚úÖ .exe / .bat / .msi - –£–°–¢–ê–ù–û–í–ö–ê
            if (['exe', 'bat', 'msi', 'cmd'].includes(ext)) {
                showNotification(`‚öôÔ∏è –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ${file.name}`, 2500);
                
                setTimeout(() => {
                    const installerWin = document.createElement('div');
                    installerWin.className = 'neon-app';
                    installerWin.style.width = '450px';
                    installerWin.innerHTML = `
                        <button class="app-close">‚úï</button>
                        <div class="app-header">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <h2>–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ Neon OS</h2>
                        </div>
                        <div class="app-content" style="text-align: center;">
                            <div style="font-size: 2.8rem; margin-bottom: 16px;">üì¶</div>
                            <div style="margin-bottom: 16px; font-size: 1.2rem;">${file.name}</div>
                            <div style="background: rgba(0,0,0,0.4); border-radius: 30px; padding: 16px; margin-bottom: 20px; text-align: left;">
                                üìã –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ<br>
                                üîí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ .app
                            </div>
                            <div style="display: flex; gap: 16px; justify-content: center;">
                                <button id="installBtn" style="background: hsl(var(--hue1),70%,60%); border: none; padding: 0.7em 2.2em; border-radius: 30px; color: white; font-size: 1rem; cursor: pointer;">‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                                <button class="app-close" style="background: rgba(255,255,255,0.2); border: none; padding: 0.7em 2.2em; border-radius: 30px; color: white; font-size: 1rem; cursor: pointer;">‚ùå –û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(installerWin);
                    
                    installerWin.querySelector('#installBtn').addEventListener('click', () => {
                        const appName = file.name.replace('.exe', '').replace('.bat', '').replace('.msi', '').replace('.cmd', '');
                        const newApp = {
                            name: `${appName}.app`,
                            type: 'app',
                            size: '1.5 MB',
                            date: new Date().toLocaleDateString(),
                            content: 'NEON_APP_INSTALLED',
                            appName: appName,
                            appType: 'app'
                        };
                        neonFileSystem.push(newApp);
                        saveFileSystem();
                        showNotification(`‚úÖ ${appName}.app —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.`, 3500);
                        installerWin.remove();
                    });
                    
                    installerWin.querySelectorAll('.app-close').forEach(btn => {
                        btn.addEventListener('click', () => installerWin.remove());
                    });
                }, 200);
                return;
            }
            
            // ‚úÖ .txt / .md / .log - –ü–†–û–°–ú–û–¢–† –ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï
            if (['txt', 'md', 'log', 'json', 'js', 'css', 'html'].includes(ext)) {
                const viewerWin = document.createElement('div');
                viewerWin.className = 'neon-app';
                viewerWin.style.width = '550px';
                viewerWin.innerHTML = `
                    <button class="app-close">‚úï</button>
                    <div class="app-header">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h7.5"/>
                        </svg>
                        <h2>${file.name}</h2>
                    </div>
                    <div class="app-content">
                        <div class="file-viewer">${file.content || '–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª'}</div>
                        <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
                            <button id="editFileBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 0.6em 1.8em; border-radius: 30px; color: white; cursor: pointer;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(viewerWin);
                
                viewerWin.querySelector('#editFileBtn')?.addEventListener('click', () => {
                    const newContent = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞:', file.content || '');
                    if (newContent !== null) {
                        file.content = newContent;
                        saveFileSystem();
                        viewerWin.querySelector('.file-viewer').innerHTML = newContent;
                        showNotification('üíæ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    }
                });
                
                viewerWin.querySelector('.app-close').addEventListener('click', () => viewerWin.remove());
                return;
            }
            
            // ‚úÖ .png / .jpg / .gif - –ü–†–û–°–ú–û–¢–† –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
            if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) {
                const imgWin = document.createElement('div');
                imgWin.className = 'neon-app';
                imgWin.style.width = '500px';
                imgWin.innerHTML = `
                    <button class="app-close">‚úï</button>
                    <div class="app-header">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"/>
                        </svg>
                        <h2>${file.name}</h2>
                    </div>
                    <div class="app-content" style="display: flex; justify-content: center; align-items: center; min-height: 250px;">
                        <div style="background: linear-gradient(135deg, hsl(var(--hue1),70%,60%), hsl(var(--hue2),70%,60%)); width: 200px; height: 200px; border-radius: 24px; display: flex; align-items: center; justify-content: center; font-size: 4rem; box-shadow: 0 0 30px rgba(0,0,0,0.5);">
                            üñºÔ∏è
                        </div>
                    </div>
                `;
                document.body.appendChild(imgWin);
                imgWin.querySelector('.app-close').addEventListener('click', () => imgWin.remove());
                return;
            }
            
            // ‚úÖ .mp3 / .wav / .ogg - –ê–£–î–ò–û–ü–õ–ï–ï–†
            if (['mp3', 'wav', 'ogg', 'flac'].includes(ext)) {
                const audioWin = document.createElement('div');
                audioWin.className = 'neon-app';
                audioWin.style.width = '450px';
                audioWin.innerHTML = `
                    <button class="app-close">‚úï</button>
                    <div class="app-header">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a2.25 2.25 0 01-2.673-1.632l-.377-1.32a2.25 2.25 0 011.632-2.673L19.5 9.553z"/>
                        </svg>
                        <h2>Neon Player</h2>
                    </div>
                    <div class="app-content" style="text-align: center;">
                        <div style="font-size: 3.5rem; margin-bottom: 16px;">üéµ</div>
                        <div style="margin-bottom: 20px; font-size: 1.2rem;"><b>${file.name}</b></div>
                        <div style="background: rgba(0,0,0,0.4); border-radius: 40px; padding: 16px;">
                            <span style="font-size: 1.5rem;">‚ñ∂Ô∏è</span> –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (—ç–º—É–ª—è—Ü–∏—è)
                        </div>
                    </div>
                `;
                document.body.appendChild(audioWin);
                audioWin.querySelector('.app-close').addEventListener('click', () => audioWin.remove());
                return;
            }
            
            showNotification(`‚ùå –ù–µ—Ç –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –¥–ª—è .${ext}`, 2000);
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í ==========
        function handleDownloadedFile(filename, content = '') {
            const ext = filename.split('.').pop().toLowerCase();
            
            const newFile = {
                name: filename,
                type: ext,
                size: Math.floor(Math.random() * 5 + 1) + '.' + Math.floor(Math.random() * 9) + ' MB',
                date: new Date().toLocaleDateString(),
                content: content || `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ ${filename} (–∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ NeonBrowser)`
            };
            
            neonFileSystem.push(newFile);
            saveFileSystem();
            
            if (['exe', 'bat', 'msi', 'cmd'].includes(ext)) {
                showNotification(`üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫: ${filename}`, 3000);
            } else {
                showNotification(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω: ${filename}`, 2000);
            }
        }

        // ========== –§–ê–ô–õ–û–í–´–ô –ú–ï–ù–ï–î–ñ–ï–† ==========
        function createFileManager() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '650px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M2.5 12.5L9 5l6.5 7.5M9 5v14"/>
                    </svg>
                    <h2>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h2>
                </div>
                <div class="app-content">
                    <div class="file-list" id="fileList"></div>
                    <div class="download-area" id="downloadArea">
                        ‚¨áÔ∏è –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                        <input type="file" id="fileUpload" multiple style="display: none;">
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            function renderFiles() {
                const list = win.querySelector('#fileList');
                list.innerHTML = '';
                neonFileSystem.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    
                    let icon = 'üìÑ';
                    if (file.type === 'app') icon = '‚úÖ';
                    else if (file.type === 'exe' || file.type === 'bat') icon = '‚öôÔ∏è';
                    else if (file.type === 'txt' || file.type === 'md') icon = 'üìù';
                    else if (['png', 'jpg', 'gif'].includes(file.type)) icon = 'üñºÔ∏è';
                    else if (file.type === 'mp3') icon = 'üéµ';
                    
                    item.innerHTML = `
                        <span class="file-icon">${icon}</span>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">${file.size} ¬∑ ${file.date} ¬∑ ${file.type}</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-run" data-index="${index}">üöÄ –ó–∞–ø—É—Å–∫</button>
                            <button class="file-delete" data-index="${index}">üóëÔ∏è</button>
                        </div>
                    `;
                    
                    item.querySelector('.file-run').addEventListener('click', (e) => {
                        e.stopPropagation();
                        runFile(file);
                    });
                    
                    item.querySelector('.file-delete').addEventListener('click', (e) => {
                        e.stopPropagation();
                        neonFileSystem.splice(index, 1);
                        saveFileSystem();
                        renderFiles();
                        showNotification(`üóëÔ∏è ${file.name} —É–¥–∞–ª–µ–Ω`);
                    });
                    
                    item.addEventListener('dblclick', () => runFile(file));
                    
                    list.appendChild(item);
                });
            }
            
            const dropArea = win.querySelector('#downloadArea');
            const fileInput = win.querySelector('#fileUpload');
            
            dropArea.addEventListener('click', () => fileInput.click());
            dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.style.borderColor = 'hsl(var(--hue1),70%,70%)'; dropArea.style.background = 'rgba(100,100,200,0.2)'; });
            dropArea.addEventListener('dragleave', () => { dropArea.style.borderColor = 'rgba(255,255,255,0.3)'; dropArea.style.background = 'transparent'; });
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.style.borderColor = 'rgba(255,255,255,0.3)';
                dropArea.style.background = 'transparent';
                const files = e.dataTransfer.files;
                for (let file of files) {
                    handleDownloadedFile(file.name, `–ü–µ—Ä–µ—Ç–∞—â–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: ${file.name}`);
                }
                renderFiles();
            });
            
            fileInput.addEventListener('change', () => {
                for (let file of fileInput.files) {
                    handleDownloadedFile(file.name, `–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: ${file.name}`);
                }
                renderFiles();
                fileInput.value = '';
            });
            
            renderFiles();
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –ò–ì–†–ê: –ó–ú–ï–ô–ö–ê ==========
        function createSnakeGame(size = 15) {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '550px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6v6l4 2"/><circle cx="12" cy="12" r="9"/>
                    </svg>
                    <h2>Neon Snake ${size}x${size}</h2>
                </div>
                <div class="app-content">
                    <div id="snakeGrid" class="snake-grid" style="grid-template-columns: repeat(${size}, 1fr);"></div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                        <span style="font-size: 1.1rem;">üêç –î–ª–∏–Ω–∞: <span id="snakeScore" style="font-size: 1.3rem; font-weight: bold; color: hsl(var(--hue1),80%,70%);">3</span></span>
                        <span id="snakeStatus" style="font-size: 1.1rem; color: hsl(var(--hue2),80%,70%);">‚ñ∂Ô∏è –ò–≥—Ä–∞</span>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button id="snakeRestart" style="background: hsl(var(--hue1),70%,60%); border: none; padding: 0.7em 2em; border-radius: 30px; color: white; font-size: 0.95rem; font-weight: 600; cursor: pointer; flex: 1;">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                        <button id="snakePause" style="background: rgba(255,255,255,0.2); border: none; padding: 0.7em 2em; border-radius: 30px; color: white; font-size: 0.95rem; cursor: pointer; flex: 1;">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            const grid = win.querySelector('#snakeGrid');
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.className = 'snake-cell';
                grid.appendChild(cell);
            }
            
            const cells = win.querySelectorAll('.snake-cell');
            let snake = [Math.floor(size/2) * size + Math.floor(size/2)];
            let direction = 'right';
            let nextDirection = 'right';
            let food = -1;
            let gameInterval = null;
            let gameActive = true;
            let gamePaused = false;
            let score = 3;
            
            function placeFood() {
                const empty = [];
                cells.forEach((cell, idx) => { if (!snake.includes(idx)) empty.push(idx); });
                if (empty.length > 0) {
                    food = empty[Math.floor(Math.random() * empty.length)];
                    cells[food]?.classList.add('food');
                }
            }
            
            function updateGrid() {
                cells.forEach(cell => cell.classList.remove('snake', 'food'));
                snake.forEach(seg => cells[seg]?.classList.add('snake'));
                if (food !== -1) cells[food]?.classList.add('food');
            }
            
            function moveSnake() {
                if (!gameActive || gamePaused) return;
                
                direction = nextDirection;
                const head = snake[0];
                const row = Math.floor(head / size);
                const col = head % size;
                let newHead = head;
                
                if (direction === 'right') newHead = row * size + (col + 1);
                else if (direction === 'left') newHead = row * size + (col - 1);
                else if (direction === 'up') newHead = (row - 1) * size + col;
                else if (direction === 'down') newHead = (row + 1) * size + col;
                
                if (newHead < 0 || newHead >= size * size || 
                    (direction === 'right' && col === size - 1) ||
                    (direction === 'left' && col === 0) ||
                    (direction === 'up' && row === 0) ||
                    (direction === 'down' && row === size - 1) ||
                    (snake.includes(newHead) && newHead !== snake[snake.length - 1])) {
                    win.querySelector('#snakeStatus').innerHTML = 'üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';
                    gameActive = false;
                    clearInterval(gameInterval);
                    return;
                }
                
                snake.unshift(newHead);
                if (newHead === food) {
                    score++;
                    win.querySelector('#snakeScore').textContent = score;
                    placeFood();
                } else {
                    snake.pop();
                }
                updateGrid();
            }
            
            function initGame() {
                gameActive = true;
                gamePaused = false;
                win.querySelector('#snakeStatus').innerHTML = '‚ñ∂Ô∏è –ò–≥—Ä–∞';
                win.querySelector('#snakePause').textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                snake = [Math.floor(size/2) * size + Math.floor(size/2)];
                direction = 'right';
                nextDirection = 'right';
                score = 3;
                win.querySelector('#snakeScore').textContent = '3';
                if (food !== -1) cells[food]?.classList.remove('food');
                updateGrid();
                placeFood();
                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(moveSnake, 140);
            }
            
            win.addEventListener('keydown', (e) => {
                if (!gameActive || gamePaused) return;
                e.preventDefault();
                if (e.key === 'ArrowUp' && direction !== 'down') nextDirection = 'up';
                if (e.key === 'ArrowDown' && direction !== 'up') nextDirection = 'down';
                if (e.key === 'ArrowLeft' && direction !== 'right') nextDirection = 'left';
                if (e.key === 'ArrowRight' && direction !== 'left') nextDirection = 'right';
            });
            
            win.querySelector('#snakeRestart').addEventListener('click', initGame);
            win.querySelector('#snakePause').addEventListener('click', function() {
                gamePaused = !gamePaused;
                win.querySelector('#snakeStatus').innerHTML = gamePaused ? '‚è∏Ô∏è –ü–∞—É–∑–∞' : '‚ñ∂Ô∏è –ò–≥—Ä–∞';
                this.textContent = gamePaused ? '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '‚è∏Ô∏è –ü–∞—É–∑–∞';
            });
            
            win.tabIndex = 0;
            win.focus();
            initGame();
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== NEONBROWSER ==========
        function createNeonBrowser() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '650px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="9"/><path d="M12 3v18M3 12h18"/>
                    </svg>
                    <h2>NeonBrowser</h2>
                </div>
                <div class="app-content">
                    <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                        <input id="browserUrl" class="browser-url" placeholder="https:// –∏–ª–∏ –ø–æ–∏—Å–∫" value="https://example.com">
                        <button id="browserGo" class="browser-go">–ü–µ—Ä–µ–π—Ç–∏</button>
                    </div>
                    <div style="background: white; border-radius: 20px; height: 320px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2);">
                        <iframe id="browserFrame" src="https://example.com" style="width:100%; height:100%; border:none;" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-downloads"></iframe>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 16px; color: rgba(255,255,255,0.7); font-size: 0.85rem;">
                        <span>üåê WebView ¬∑ –ó–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è</span>
                        <span style="color: hsl(var(--hue1),80%,70%);">‚¨áÔ∏è .exe .bat ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∫–∞</span>
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            const urlInput = win.querySelector('#browserUrl');
            const frame = win.querySelector('#browserFrame');
            
            win.querySelector('#browserGo').addEventListener('click', () => {
                let url = urlInput.value.trim();
                if (!url) return;
                if (!url.startsWith('http')) url = 'https://' + url;
                frame.src = url;
                
                setTimeout(() => {
                    if (url.includes('.exe') || url.includes('.bat') || url.includes('.msi')) {
                        const filename = url.split('/').pop() || 'installer.exe';
                        handleDownloadedFile(filename, `–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ NeonBrowser: ${url}`);
                        showNotification(`‚¨áÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: ${filename}`, 2500);
                    }
                }, 1200);
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –ü–û–ì–û–î–ê ==========
        async function fetchWeather(city) {
            try {
                const res = await fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city)}&lang=ru`);
                const data = await res.json();
                return { 
                    temp: Math.round(data.current.temp_c), 
                    feels: Math.round(data.current.feelslike_c),
                    condition: data.current.condition.text,
                    wind: data.current.wind_kph,
                    humidity: data.current.humidity
                };
            } catch { return null; }
        }

        function createWeatherApp() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '500px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"/>
                    </svg>
                    <h2>–ü–æ–≥–æ–¥–∞ ¬∑ –†–æ—Å—Å–∏—è</h2>
                </div>
                <div class="app-content">
                    <div id="weatherDisplay" style="text-align: center; margin-bottom: 20px; font-size: 1.2rem;">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        ${RUSSIAN_CITIES.map(c => 
                            `<button class="weather-city" style="background: rgba(30,40,70,0.7); border: 1px solid rgba(255,255,255,0.2); border-radius: 40px; padding: 0.7em 1.5em; color: white; cursor: pointer; transition: 0.2s;">${c}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            win.querySelectorAll('.weather-city').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const city = btn.textContent;
                    const weather = await fetchWeather(city);
                    if (weather) {
                        win.querySelector('#weatherDisplay').innerHTML = `
                            <div style="font-size: 2.5rem; font-weight: 300; margin-bottom: 8px;">${weather.temp}¬∞C</div>
                            <div style="font-size: 1.2rem; margin-bottom: 4px;">${city}</div>
                            <div style="margin-bottom: 16px; opacity: 0.9;">${weather.condition}</div>
                            <div style="display: flex; justify-content: center; gap: 24px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 40px;">
                                <span>üíß ${weather.humidity}%</span>
                                <span>üå¨ ${weather.wind} –∫–º/—á</span>
                                <span>üå° –æ—â—É—â. ${weather.feels}¬∞C</span>
                            </div>
                        `;
                    } else {
                        win.querySelector('#weatherDisplay').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                    }
                });
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† ==========
        function createCalculator() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '380px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5Zm0 2.25h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V18Zm2.498-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z"/>
                    </svg>
                    <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
                </div>
                <div class="app-content">
                    <div id="calcDisplay" style="background: rgba(0,0,0,0.5); padding: 0.8em 1em; border-radius: 20px; text-align: right; font-size: 2.2rem; font-family: var(--font-mono); margin-bottom: 16px;">0</div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                        ${['C','√∑','√ó','‚àí',7,8,9,'+',4,5,6,'=',1,2,3,0,'.'].map(v => 
                            `<button class="calc-btn" style="background: rgba(20,30,50,0.8); border: 1px solid rgba(255,255,255,0.1); padding: 0.9em 0; border-radius: 20px; font-size: 1.2rem; color: white; cursor: pointer; transition: 0.1s;">${v}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            const display = win.querySelector('#calcDisplay');
            let current = '0', prev = '', op = null, reset = false;
            
            win.querySelectorAll('.calc-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const txt = btn.textContent;
                    
                    if (!isNaN(txt) || txt === '.') {
                        if (txt === '.' && current.includes('.')) return;
                        if (current === '0' || reset) { current = txt; reset = false; }
                        else current += txt;
                        display.textContent = current.slice(0, 12);
                    } else if (txt === 'C') {
                        current = '0'; prev = ''; op = null; reset = false;
                        display.textContent = '0';
                    } else if (txt === '=') {
                        if (op) {
                            const a = parseFloat(prev), b = parseFloat(current);
                            if (!isNaN(a) && !isNaN(b)) {
                                if (op === '+') current = (a + b).toString();
                                else if (op === '‚àí') current = (a - b).toString();
                                else if (op === '√ó') current = (a * b).toString();
                                else if (op === '√∑') current = b !== 0 ? (a / b).toString() : 'ERR';
                            }
                        }
                        op = null; prev = ''; reset = true;
                        display.textContent = current.slice(0, 12);
                    } else if (['+', '‚àí', '√ó', '√∑'].includes(txt)) {
                        if (op && !reset) {
                            const a = parseFloat(prev), b = parseFloat(current);
                            if (!isNaN(a) && !isNaN(b)) {
                                if (op === '+') current = (a + b).toString();
                                else if (op === '‚àí') current = (a - b).toString();
                                else if (op === '√ó') current = (a * b).toString();
                                else if (op === '√∑') current = b !== 0 ? (a / b).toString() : 'ERR';
                            }
                        }
                        prev = current; op = txt; reset = true;
                        display.textContent = current.slice(0, 12);
                    }
                });
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –ó–ê–ú–ï–¢–ö–ò ==========
        function createNotesApp() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '500px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h4.5m-5.273-9.955a3.75 3.75 0 0 1 5.304 0l6.19 6.19a3.75 3.75 0 0 1 0 5.304l-4.095 4.095a3.75 3.75 0 0 1-5.304 0l-6.19-6.19a3.75 3.75 0 0 1 0-5.304l1.095-1.095Z"/>
                    </svg>
                    <h2>–ó–∞–º–µ—Ç–∫–∏</h2>
                </div>
                <div class="app-content">
                    <textarea id="notesText" style="width: 100%; min-height: 200px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); border-radius: 16px; padding: 1em; color: white; font-family: var(--font-mono); font-size: 0.95rem; resize: vertical;">‚ö° Neon OS –ó–∞–º–µ—Ç–∫–∏

‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è .app
‚Ä¢ –ó–º–µ–π–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ
‚Ä¢ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã</textarea>
                    <div style="display: flex; gap: 12px; margin-top: 16px; justify-content: flex-end;">
                        <button id="saveNotesBtn" style="background: hsl(var(--hue1),70%,60%); border: none; padding: 0.6em 1.8em; border-radius: 30px; color: white; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            win.querySelector('#saveNotesBtn').addEventListener('click', () => {
                const notes = win.querySelector('#notesText').value;
                const notesFile = neonFileSystem.find(f => f.name === 'notes.txt');
                if (notesFile) {
                    notesFile.content = notes;
                } else {
                    neonFileSystem.push({
                        name: 'notes.txt',
                        type: 'txt',
                        size: '1.1 KB',
                        date: new Date().toLocaleDateString(),
                        content: notes
                    });
                }
                saveFileSystem();
                showNotification('üíæ –ó–∞–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –ú–£–ó–´–ö–ê ==========
        function createMusicApp() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '450px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a2.25 2.25 0 01-2.673-1.632l-.377-1.32a2.25 2.25 0 011.632-2.673L19.5 9.553z"/>
                    </svg>
                    <h2>Neon Music</h2>
                </div>
                <div class="app-content">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; background: rgba(0,0,0,0.35); padding: 1.2em; border-radius: 30px;">
                        <span style="background: hsl(var(--hue1),70%,60%); width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer;">‚ñ∂Ô∏è</span>
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 600;">Neon Dreams</div>
                            <div style="opacity: 0.7;">Wave</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 20px; background: rgba(0,0,0,0.35); padding: 1.2em; border-radius: 30px;">
                        <span style="background: rgba(255,255,255,0.2); width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer;">‚ñ∂Ô∏è</span>
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 600;">Glass City</div>
                            <div style="opacity: 0.7;">Synth</div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            win.querySelectorAll('span[style*="cursor: pointer"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.textContent = this.textContent === '‚ñ∂Ô∏è' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
                });
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –¢–ï–†–ú–ò–ù–ê–õ ==========
        function createTerminalApp() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '550px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 5.25h13.5A2.25 2.25 0 0 0 21 15V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v9a2.25 2.25 0 0 0 2.25 2.25Z"/>
                    </svg>
                    <h2>Neon Terminal</h2>
                </div>
                <div class="app-content" style="font-family: 'JetBrains Mono'; background: #0a0c12;">
                    <div style="margin-bottom: 8px;"><span style="color: #9dd0ff;">‚ùØ</span> <span style="color: #a0f0aa;">neon@os</span>:~$</div>
                    <div style="margin-bottom: 8px; color: #9dd0ff;">‚úì Neon OS v2.0 ¬∑ –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</div>
                    <div style="margin-bottom: 8px;"><span style="color: #9dd0ff;">‚ùØ</span> ls -la *.app</div>
                    <div style="margin-bottom: 8px; color: white;">${neonFileSystem.filter(f => f.type === 'app').map(f => f.name).join('\n') || '–ù–µ—Ç .app —Ñ–∞–π–ª–æ–≤'}</div>
                    <div><span style="color: #9dd0ff;">‚ùØ</span> <span style="color: #a0f0aa;">_</span></div>
                </div>
            `;
            document.body.appendChild(win);
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –¢–ê–ô–ú–ï–† ==========
        function createTimerApp() {
            closeCurrentApp();
            const win = document.createElement('div');
            win.className = 'neon-app';
            win.style.width = '400px';
            win.innerHTML = `
                <button class="app-close">‚úï</button>
                <div class="app-header">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6v6l4 2m-4-10.5a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z"/>
                    </svg>
                    <h2>–¢–∞–π–º–µ—Ä</h2>
                </div>
                <div class="app-content" style="text-align: center;">
                    <div id="timerDisplay" style="font-size: 3.5rem; font-family: var(--font-mono); margin-bottom: 24px; color: hsl(var(--hue1),80%,70%);">05:00</div>
                    <div style="display: flex; gap: 16px; justify-content: center;">
                        <button id="timerStartBtn" style="background: hsl(var(--hue1),70%,60%); border: none; padding: 0.7em 2.2em; border-radius: 30px; color: white; font-size: 1rem; cursor: pointer;">–°—Ç–∞—Ä—Ç</button>
                        <button id="timerResetBtn" style="background: rgba(255,255,255,0.2); border: none; padding: 0.7em 2.2em; border-radius: 30px; color: white; font-size: 1rem; cursor: pointer;">–°–±—Ä–æ—Å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(win);
            
            let timerInterval, timeLeft = 300;
            const display = win.querySelector('#timerDisplay');
            
            function updateDisplay() {
                const m = Math.floor(timeLeft / 60);
                const s = timeLeft % 60;
                display.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            }
            
            win.querySelector('#timerStartBtn').addEventListener('click', function() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    this.textContent = '–°—Ç–∞—Ä—Ç';
                } else {
                    timerInterval = setInterval(() => {
                        if (timeLeft > 0) {
                            timeLeft--;
                            updateDisplay();
                        } else {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            win.querySelector('#timerStartBtn').textContent = '–°—Ç–∞—Ä—Ç';
                        }
                    }, 1000);
                    this.textContent = '–ü–∞—É–∑–∞';
                }
            });
            
            win.querySelector('#timerResetBtn').addEventListener('click', () => {
                timeLeft = 300;
                updateDisplay();
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    win.querySelector('#timerStartBtn').textContent = '–°—Ç–∞—Ä—Ç';
                }
            });
            
            win.querySelector('.app-close').addEventListener('click', () => win.remove());
        }

        // ========== –û–ë–û–ò ==========
        const wallpapers = [
            { name: "Abstract Neon", url: "https://assets.codepen.io/13471/abstract-light.jpg", preview: "https://assets.codepen.io/13471/abstract-light.jpg", overlay: "linear-gradient(to right in oklab, hsl(var(--hue2) 50% 75%), hsl(var(--hue1) 50% 75%))" },
            { name: "Cyber Grid", url: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=500&auto=format", preview: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=100&h=60&fit=crop", overlay: "linear-gradient(45deg, hsl(var(--hue1) 70% 60% / 0.2), hsl(var(--hue2) 70% 60% / 0.2))" },
            { name: "Neon City", url: "https://images.unsplash.com/photo-1519608487953-e17c5135a08e?w=500&auto=format", preview: "https://images.unsplash.com/photo-1519608487953-e17c5135a08e?w=100&h=60&fit=crop", overlay: "linear-gradient(135deg, hsl(var(--hue1) 70% 60% / 0.3), hsl(var(--hue2) 70% 60% / 0.3))" },
            { name: "Purple Storm", url: "https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=500&auto=format", preview: "https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=100&h=60&fit=crop", overlay: "linear-gradient(to bottom, hsl(var(--hue1) 70% 60% / 0.3), rgba(0,0,0,0.5))" },
            { name: "Blue Abyss", url: "https://images.unsplash.com/photo-1518834107812-67b0b7c58434?w=500&auto=format", preview: "https://images.unsplash.com/photo-1518834107812-67b0b7c58434?w=100&h=60&fit=crop", overlay: "radial-gradient(circle, hsl(var(--hue1) 70% 60% / 0.3), rgba(0,0,0,0.7))" },
            { name: "Synthwave", url: "https://images.unsplash.com/photo-1503435980610-a51f3ddfee50?w=500&auto=format", preview: "https://images.unsplash.com/photo-1503435980610-a51f3ddfee50?w=100&h=60&fit=crop", overlay: "linear-gradient(90deg, hsl(var(--hue1) 70% 60% / 0.4), hsl(var(--hue2) 70% 60% / 0.4))" }
        ];

        function showNotification(text, duration = 2500) {
            const notif = document.createElement('div');
            notif.className = 'neon-notification';
            notif.textContent = text;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), duration);
        }

        function setWallpaper(url, overlay) {
            document.documentElement.style.setProperty('--wallpaper', `url('${url}')`);
            document.documentElement.style.setProperty('--wallpaper-overlay', overlay);
        }

        function initWallpaperGrid() {
            const grid = document.getElementById('wallpaperGrid');
            if (!grid) return;
            grid.innerHTML = '';
            wallpapers.forEach((wp, i) => {
                const item = document.createElement('div');
                item.className = 'wallpaper-item';
                item.style.backgroundImage = `url('${wp.preview}')`;
                item.dataset.url = wp.url;
                item.dataset.overlay = wp.overlay;
                item.title = wp.name;
                
                const current = localStorage.getItem('neon-wallpaper-url') || wallpapers[0].url;
                if (wp.url === current) item.classList.add('active');
                
                item.addEventListener('click', () => {
                    document.querySelectorAll('.wallpaper-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    setWallpaper(wp.url, wp.overlay);
                    localStorage.setItem('neon-wallpaper-url', wp.url);
                    localStorage.setItem('neon-wallpaper-overlay', wp.overlay);
                    showNotification(`üé® –û–±–æ–∏: ${wp.name}`);
                });
                grid.appendChild(item);
            });
        }

        function loadSavedWallpaper() {
            const url = localStorage.getItem('neon-wallpaper-url');
            const overlay = localStorage.getItem('neon-wallpaper-overlay');
            if (url) setWallpaper(url, overlay);
            else setWallpaper(wallpapers[0].url, wallpapers[0].overlay);
        }

        // ========== –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function closeCurrentApp() {
            const existing = document.querySelector('.neon-app');
            if (existing) existing.remove();
        }

        // ---------- –ú–ï–ù–Æ ----------
        document.addEventListener("contextmenu", (e) => {
            const menuBox = $menu.getBoundingClientRect();
            const win = { width: window.innerWidth, height: window.innerHeight };
            let pos = { x: e.clientX, y: e.clientY };
            if (pos.x + menuBox.width >= win.width - 20) pos.x = win.width - menuBox.width - 20;
            if (pos.y + menuBox.height >= win.height - 20) pos.y = win.height - menuBox.height - 20;
            if (!$menu.contains(e.target)) {
                $menu.style.left = pos.x + 'px';
                $menu.style.top = pos.y + 'px';
                $menu.classList.add('open');
                clearTimeout(cleanTimer);
            }
            e.preventDefault();
        });

        $openWallpaperBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const rect = $openWallpaperBtn.getBoundingClientRect();
            $menu.style.left = (rect.left - 20) + 'px';
            $menu.style.top = (rect.top - 320) + 'px';
            $menu.classList.add('open');
            clearTimeout(cleanTimer);
        });

        document.addEventListener('pointerdown', (e) => {
            const isMenu = $menu.contains(e.target);
            const isSlider = e.target.matches && e.target.matches('input[type="range"]');
            const isWallpaperBtn = e.target === $openWallpaperBtn || $openWallpaperBtn?.contains(e.target);
            
            if (!isMenu && !isSlider && !isWallpaperBtn) {
                $menu.classList.remove('open');
                cleanTimer = setTimeout(() => {
                    $menuItems.forEach(el => el.classList.remove('selected'));
                }, 200);
            } else if (isMenu && e.target.matches && e.target.matches('li')) {
                $menuItems.forEach(el => el.classList.remove('selected'));
                e.target.classList.add('selected');
            }
        });

        // ---------- –¶–í–ï–¢–û–í–´–ï –°–õ–ê–ô–î–ï–†–´ ----------
        $hue1.addEventListener('input', (e) => {
            document.body.style.setProperty('--hue1', e.target.value);
            localStorage.setItem('neon-glass-hue1', e.target.value);
        });
        $hue2.addEventListener('input', (e) => {
            document.body.style.setProperty('--hue2', e.target.value);
            localStorage.setItem('neon-glass-hue2', e.target.value);
        });

        const setHues = (random = false) => {
            const r1 = 120 + Math.floor(Math.random() * 240);
            const r2 = r1 - 80 + (Math.floor(Math.random() * 60) - 30);
            const v1 = random ? r1 : (localStorage.getItem('neon-glass-hue1') ?? r1);
            const v2 = random ? r2 : (localStorage.getItem('neon-glass-hue2') ?? r2);
            $hue1.value = v1; $hue2.value = v2;
            document.body.style.setProperty('--hue1', v1);
            document.body.style.setProperty('--hue2', v2);
        };
        setHues();
        $rand.addEventListener('click', () => { setHues(true); showNotification('üé® –¢–µ–º–∞ —Å–ª—É—á–∞–π–Ω–∞—è!'); });

        window.addEventListener('keydown', (e) => { 
            if (e.key === 'Escape') {
                $menu.classList.remove('open');
                const app = document.querySelector('.neon-app'); 
                if (app) app.remove(); 
            } 
        });

        // ---------- –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–ô ----------
        const appLauncher = {
            snake: () => createSnakeGame(15),
            snake2: () => createSnakeGame(12),
            browser: createNeonBrowser,
            files: createFileManager,
            weather: createWeatherApp,
            calculator: createCalculator,
            notes: createNotesApp,
            music: createMusicApp,
            terminal: createTerminalApp,
            timer: createTimerApp
        };

        $menuItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                const appId = item.dataset.app;
                if (appId && appLauncher[appId]) {
                    appLauncher[appId]();
                    $menu.classList.remove('open');
                    showNotification(`‚ú® ${item.textContent.trim()}`, 1500);
                }
            });
        });

        // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
        initWallpaperGrid();
        loadSavedWallpaper();
        saveFileSystem();
        
        console.log('Neon OS v2.0 ¬∑ –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    })();
</script>
</body>
</html>
